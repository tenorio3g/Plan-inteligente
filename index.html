<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PWA Actividades</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f4f4f4; }
    .hidden { display: none; }
    .modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 2rem; border-radius: 8px; text-align: center;
    }
    textarea, input, button { margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    .card { background: white; padding: 1rem; border-radius: 6px; margin-top: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    img { max-width: 100px; margin-top: 0.5rem; }
  </style>
</head>
<body>

<div class="modal" id="loginModal">
  <div class="modal-content">
    <h2>Ingrese su número de empleado</h2>
    <input type="text" id="employeeId" placeholder="Ejemplo: 0001">
    <button onclick="login()">Entrar</button>
  </div>
</div>

<h1 id="title">Gestión de Actividades</h1>

<div id="adminPanel" class="hidden">
  <h2>Formulario de actividad</h2>
  <input type="text" id="titulo" placeholder="Título de actividad">
  <textarea id="comentario" placeholder="Comentario"></textarea>
  <input type="file" id="foto" accept="image/*">
  <input type="text" id="asignado" placeholder="Asignar a (ej: 0002)">
  <button onclick="guardarActividad()">Guardar</button>
</div>

<div id="tareasAsignadas" class="hidden">
  <h2>Tareas asignadas</h2>
  <div id="listaTareas"></div>
</div>

<script>
  const actividades = JSON.parse(localStorage.getItem("actividades") || "[]");
  let usuarioActual = null;

  function login() {
    const id = document.getElementById("employeeId").value.trim();
    if (!id) return alert("Ingrese un ID válido");

    usuarioActual = id;
    document.getElementById("loginModal").style.display = "none";

    if (id === "0001") {
      document.getElementById("adminPanel").classList.remove("hidden");
    }

    document.getElementById("tareasAsignadas").classList.remove("hidden");
    mostrarTareas();
  }

  function guardarActividad() {
    const titulo = document.getElementById("titulo").value;
    const comentario = document.getElementById("comentario").value;
    const asignado = document.getElementById("asignado").value;
    const fotoInput = document.getElementById("foto");

    const reader = new FileReader();
    reader.onload = function (e) {
      const nueva = { titulo, comentario, asignado, foto: e.target.result };
      actividades.push(nueva);
      localStorage.setItem("actividades", JSON.stringify(actividades));
      mostrarTareas();
      alert("Actividad guardada");
    };

    if (fotoInput.files[0]) {
      reader.readAsDataURL(fotoInput.files[0]);
    } else {
      const nueva = { titulo, comentario, asignado, foto: "" };
      actividades.push(nueva);
      localStorage.setItem("actividades", JSON.stringify(actividades));
      mostrarTareas();
      alert("Actividad guardada sin imagen");
    }
  }

  function mostrarTareas() {
    const contenedor = document.getElementById("listaTareas");
    contenedor.innerHTML = "";

    actividades.forEach(act => {
      if (usuarioActual === "0001" || act.asignado === usuarioActual) {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <strong>${act.titulo}</strong><br>
          <em>Asignado a: ${act.asignado}</em><br>
          ${act.comentario}<br>
          ${act.foto ? `<img src="${act.foto}">` : ""}
        `;
        contenedor.appendChild(div);
      }
    });
  }
</script>

</body>
</html>
